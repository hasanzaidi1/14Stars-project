<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Registration</title>
    <link rel="stylesheet" href="/styles.css">
</head>
<body>
    <header class="site-header">
        <a class="brand-mark" href="/index.html">14 Stars</a>
        <button class="nav-toggle" type="button" data-nav-toggle data-target="primary-nav" aria-label="Toggle navigation" aria-expanded="false">â˜°</button>
        <nav class="nav-links" id="primary-nav">
            <a class="nav-link" href="/parents/parents_portal.html">Parent Portal</a>
            <a class="nav-link" href="/parents/view_students.html">View Students</a>
            <a class="nav-link is-active" href="/parents/student_registration.html">Register Student</a>
            <button class="btn btn--danger" type="button" onclick="window.location.href='/parents/logout'">Logout</button>
        </nav>
    </header>

    <main class="stack">
        <section class="page-header">
            <div>
                <p class="page-eyebrow">Parent Portal</p>
                <h1>Register a Student</h1>
                <p class="text-muted">Provide the details below so we can match your child to the right level.</p>
            </div>
        </section>

        <section class="panel panel--narrow stack">
            <form action="/parents/register-from-parent" method="POST" id="registration-form" class="stack">
                <h2>Student Information</h2>
                <label for="fname">Student Name</label>
                <div class="student-name">
                    <input placeholder="First" type="text" id="fname" name="fname" required>
                    <input placeholder="Middle" type="text" id="MI" name="MI">
                    <input placeholder="Last" type="text" id="lname" name="lname" required>
                </div>

                <label for="DOB">Date Of Birth</label>
                <input type="date" id="DOB" name="DOB" required>

                <label for="st_address">Address</label>
                <input type="text" id="st_address" name="st_address" placeholder="Street" required>
                <input type="text" id="city" name="city" placeholder="City" required>
                <input type="text" id="state" name="state" placeholder="State" required>
                <input type="number" id="zip" name="zip" placeholder="Zipcode" required>

                <label for="st_email">Student Contact</label>
                <input type="text" id="st_email" name="st_email" placeholder="Email">
                <input type="text" id="st_cell" name="st_cell" placeholder="Phone Number" maxlength="10">

                <label for="student_location">Student Location</label>
                <select id="student_location" name="student_location" required>
                    <option value="on-site">On-Site</option>
                    <option value="remote">Remote</option>
                </select>

                <div class="gender-options">
                    <span class="gender-title">Gender</span>
                    <label for="male">Male</label>
                    <input type="radio" id="male" name="gender" value="male" required>
                    <label for="female">Female</label>
                    <input type="radio" id="female" name="gender" value="female" required>
                </div>

                <hr>
                <h2>Parent / Guardian</h2>
                <div class="parent-name">
                    <input type="text" name="parent-first-name" placeholder="First Name" required>
                    <input type="text" name="parent-MI" placeholder="Middle Initial">
                    <input type="text" name="parent-last-name" placeholder="Last Name" required>
                </div>

                <div class="gender-options">
                    <span class="gender-title">Guardian Gender</span>
                    <label for="pmale">Male</label>
                    <input type="radio" name="parent-gender" value="pmale" required>
                    <label for="pfemale">Female</label>
                    <input type="radio" name="parent-gender" value="pfemale" required>
                </div>

                <label for="relation">Relation</label>
                <select id="relation" name="relation" required>
                    <option value="" disabled selected>Select relation</option>
                    <option value="mother">Mother</option>
                    <option value="father">Father</option>
                    <option value="guardian">Guardian</option>
                </select>

                <div class="stack">
                    <div class="form-row" style="justify-content: space-between; align-items: center;">
                        <label for="parent_st_address">Parent Address</label>
                        <button class="btn btn--ghost" type="button" onclick="copyAddress()">Use Student Address</button>
                    </div>
                    <input type="text" id="parent_st_address" name="parent_st_address" placeholder="Street" required>
                    <input type="text" id="parent_city" name="parent_city" placeholder="City" required>
                    <input type="text" id="parent_state" name="parent_state" placeholder="State" required>
                    <input type="number" id="parent_zip" name="parent_zip" placeholder="Zipcode" required>
                </div>

                <label for="parent_cell">Parent Contact</label>
                <input type="text" id="parent_cell" name="parent_cell" placeholder="Phone Number" required>
                <p class="text-muted" style="margin-top:-0.75rem;">Your account email will be used automatically.</p>

                <div class="form-actions">
                    <button class="btn" type="submit">Submit Registration</button>
                    <button class="btn btn--ghost" type="reset">Clear</button>
                </div>
            </form>
        </section>
    </main>

    <footer class="site-footer">
        <p>&copy; 2024 14 Stars Islamic School.</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const form = document.getElementById('registration-form');
            form.addEventListener('submit', async (event) => {
                event.preventDefault();
                if (!form.reportValidity()) {
                    return;
                }
                const formData = new FormData(form);
                const payload = Object.fromEntries(formData.entries());

                try {
                    const response = await fetch('/parents/register-from-parent', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(payload),
                        credentials: 'same-origin'
                    });

                    const result = await response.json().catch(() => ({}));
                    if (response.ok && result.success) {
                        alert(result.message || 'Registration successful!');
                        form.reset();
                    } else {
                        alert(result.message || result.error || 'Unable to register student.');
                    }
                } catch (error) {
                    console.error('Server error', error);
                    alert('Failed to submit form. Try again.');
                }
            });
        });

        function copyAddress() {
            document.getElementById('parent_st_address').value = document.getElementById('st_address').value;
            document.getElementById('parent_city').value = document.getElementById('city').value;
            document.getElementById('parent_state').value = document.getElementById('state').value;
            document.getElementById('parent_zip').value = document.getElementById('zip').value;
        }
    </script>
    <script src="/scripts/ui.js" defer></script>
</body>
</html>
